<!DOCTYPE html>
<html>
<head>
  <title>Web3Modal v1 Example</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3modal@1.9.12/dist/index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
</head>
<body>
  <button id="connectBtn">Connect Wallet</button>
  <p id="walletAddress">Not connected</p>

  <script>
  const providerOptions = {
    walletconnect: {
      package: window.WalletConnectProvider.default,
      options: {
        infuraId: "YOUR_INFURA_ID" // free from infura.io
      }
    }
  };

  const web3Modal = new window.Web3Modal.default({
    cacheProvider: false,
    providerOptions
  });

  let web3;

  document.getElementById("connectBtn").addEventListener("click", async () => {
    try {
      const instance = await web3Modal.connect();
      web3 = new Web3(instance);

      const accounts = await web3.eth.getAccounts();
      const walletAddress = accounts[0];

      document.getElementById("walletAddress").innerText =
        "Connected: " + walletAddress;

      // âœ… Send to Node.js server
      fetch("/api/savewallet", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          address: walletAddress,
          walletName: instance.isWalletConnect
            ? "WalletConnect"
            : "MetaMask"
        })
      })
        .then((res) => res.json())
        .then((data) => console.log("Server response:", data))
        .catch((err) => console.error("Error sending wallet:", err));
    } catch (err) {
      console.error("Wallet connection failed:", err);
    }
  });
</script>

</body>
</html>
